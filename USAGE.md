# Virtual Fashion Try-On 使用方法

## セットアップ

### 1. APIキーの設定

初回起動時、またはメニューから「設定」→「APIキー設定」で以下のAPIキーを設定します。

#### OpenAI API Key
- 取得方法: https://platform.openai.com/api-keys
- DALL-E 3を使用する場合に必要

#### Stability AI API Key
- 取得方法: https://platform.stability.ai/account/keys
- Stable Diffusionを使用する場合に必要

#### Google Cloud Service Account
- 取得方法: https://cloud.google.com/iam/docs/service-accounts
- Google Imagenを使用する場合に必要
- サービスアカウントJSONファイルのパスを指定

### 2. 環境変数（オプション）

`.env`ファイルを作成して、以下の設定をカスタマイズできます：

```bash
# ログレベル
LOG_LEVEL=INFO

# 最大リトライ回数
MAX_RETRIES=3

# リクエストタイムアウト（秒）
REQUEST_TIMEOUT=60

# Google Cloud設定（Imagenを使用する場合）
GOOGLE_PROJECT_ID=your_project_id
GOOGLE_LOCATION=us-central1
```

## 基本的な使い方

### 1. 衣類画像のアップロード

1. 「+ 画像を追加」ボタンをクリック
2. 衣類の画像ファイルを選択（PNG/JPEG/WebP対応）
3. 衣類のタイプを選択（TOP/BOTTOM/OUTER/ONE_PIECE/ACCESSORY）
4. 必要に応じて複数の衣類を追加

**推奨画像仕様:**
- 形式: PNG（透過対応）
- 解像度: 512x512以上
- 背景: 白または透過
- 衣類が画像の中心に配置されていること

### 2. モデル属性の設定

右側のパネルで、生成するモデルの属性を選択します：

- **性別**: 女性/男性/中性的/非二元
- **年代**: 10代/20代/30代/40代/50代以上
- **国籍**: アジア系/白人系/黒人系/ヒスパニック系/混血
- **体型**: スリム/標準/がっちり/プラスサイズ
- **ポーズ**: 正面/横向き/ウォーキング/座り
- **背景**: 白/透過/スタジオ/ロケーション

### 3. 生成設定

- **AI**: 使用する画像生成AI（OpenAI/Stability/Imagen）
- **品質**: standard（標準）/ hd（高品質）
- **サイズ**: 1024x1024 / 1024x1792 / 1792x1024
- **枚数**: 1〜4枚

**プロバイダ別の特徴:**

#### ⭐ Stability AI SD 3.5（最推奨）
- **画像参照機能**: 衣類画像を直接参照して忠実に再現
- **image-to-image**: 元の衣類を高精度で再現可能
- コスト: $0.065/枚（Large）、$0.040/枚（Turbo）
- **最も正確な衣類再現が可能**

#### Google Imagen 4
- 高品質で安定した出力（2025年6月最新版）
- Gemini API経由で簡単に使用可能
- コスト: $0.040/枚（Standard）、$0.080/枚（Ultra）
- SynthID透かし付き
- 1-4枚の同時生成をサポート

#### OpenAI (DALL-E 3)
- 自然な画像生成
- コスト: $0.040〜$0.120/枚
- テキストのみ（画像参照なし）
- 制約: 1リクエスト1枚のため、複数枚生成は並列実行

### 4. 画像生成

1. 「生成開始」ボタンをクリック
2. 進捗バーで生成状況を確認
3. 生成が完了すると、結果ギャラリーに表示されます

### 5. 結果の保存

1. ギャラリーで画像を確認
2. 「保存」ボタンをクリック
3. 保存先フォルダを選択
4. 画像がPNG形式で保存されます

## 高度な使い方

### 忠実度検証

アプリケーションは生成された画像の忠実度を自動的に検証します：

- **SSIM（構造類似度）**: ≥ 0.85
- **色ヒストグラム相関**: ≥ 0.90
- **Keypointマッチング**: ≥ 0.80

閾値を満たさない場合、自動的に再生成を試みます。

### バッチ処理

複数の衣類を一度に追加し、まとめて生成することで効率的に作業できます。

### コスト管理

各プロバイダのコストは設定画面で確認できます。大量生成を行う前に、見積もりコストを確認することをお勧めします。

## トラブルシューティング

### APIエラーが発生する

- APIキーが正しく設定されているか確認
- API使用制限（レート制限）に達していないか確認
- インターネット接続を確認

### 画像が生成されない

- 衣類画像が適切な形式・解像度か確認
- APIキーに十分なクレジットがあるか確認

### 忠実度検証で不合格になる

- より高品質な衣類画像を使用
- Stability AIの場合、cfg_scaleを上げる（12〜15推奨）
- strengthを下げる（0.2〜0.3推奨）

### アプリケーションが起動しない

- 必要な依存パッケージがインストールされているか確認
- Python 3.10以上がインストールされているか確認
- エラーログを確認（`logs/app.log`）

## よくある質問

### Q: どのプロバイダを選べばいいですか？
A: **衣類の忠実再現が目的なら、Stability AI SD 3.5を強く推奨します！**

- **衣類を正確に再現したい** → ⭐ **Stability AI SD 3.5**（画像参照機能）
- 高品質な写真風 → Google Imagen 4
- 自然な仕上がり → OpenAI DALL-E 3

### Q: なぜStability AI SD 3.5が推奨なのですか？
A: **image-to-image機能**により、衣類画像を直接参照できるため：
- ✅ 色が正確に再現される（Hex色ではなく実際の画像を参照）
- ✅ 柄やテクスチャが忠実に再現される
- ✅ 全体的なデザインが保持される

他のプロバイダ（OpenAI/Imagen）はテキストプロンプトのみなので、
完全な再現は技術的に困難です。

### Q: 生成にどのくらい時間がかかりますか？
A: 通常10〜60秒程度です。ネットワーク状況やプロバイダによって異なります。

### Q: 商用利用は可能ですか？
A: 各プロバイダの利用規約に従ってください。一般的に、OpenAIとGoogle Imagenは商用利用可能です。

### Q: 生成された画像の著作権は？
A: 各プロバイダの規約に従います。一般的に、生成された画像の権利はユーザーに帰属しますが、詳細は各サービスの規約を確認してください。

## サポート

問題が解決しない場合は、GitHubのIssuesで報告してください：
https://github.com/yourname/virtual-fashion-tryon/issues

