# 自動動画生成機能 実装ガイド

**実装日**: 2025年11月15日  
**機能**: 画像生成時に自動的に動画も生成

---

## ✨ 新機能の概要

### 自動動画生成チェックボックス

```
生成設定:
  サイズ: [1024x1024▼]  枚数: [2]  ☑ 1枚目から動画を生成
```

**動作**:
- 枚数が2以上の時のみチェック可能
- チェックON: 画像生成完了後、1枚目から自動的に動画を生成
- チェックOFF: 画像のみ生成（従来通り）

---

## 🎯 ユースケース

### ケース1: 複数アングル + 動画

```
【設定】
- 枚数: 4
- モード: 角度違い
- ☑ 1枚目から動画を生成

【結果】
1. 4枚の画像が生成される（0°, 45°, 90°, 135°）
2. 自動的に1枚目（0°正面）から動画が生成される
3. 画像と動画の両方が手に入る ✅
```

### ケース2: バリエーション + 動画

```
【設定】
- 枚数: 3
- モード: 種類違い
- ☑ 1枚目から動画を生成

【結果】
1. 3枚のバリエーション画像が生成される
2. 最初の画像から動画が生成される
3. 気に入ったら2枚目・3枚目からも手動で動画生成可能
```

---

## 🔧 実装の詳細

### UI要素

```python
# チェックボックス
self.auto_video_checkbox = QCheckBox("1枚目から動画を生成")
self.auto_video_checkbox.setEnabled(False)  # 初期は無効

# 枚数変更時
def _on_num_outputs_changed(value):
    # 2以上でチェック可能
    self.auto_video_checkbox.setEnabled(value >= 2)
    if value < 2:
        self.auto_video_checkbox.setChecked(False)
```

### 自動動画生成ロジック

```python
def _on_generation_completed(images, metadata):
    # ギャラリーに表示
    gallery.set_images(images, metadata)
    
    # チェックボックスがONか確認
    if self.auto_video_checkbox.isChecked() and len(images) >= 1:
        # 1枚目の画像を取得
        first_image = images[0]
        
        # 動画パネルに設定
        video_panel.set_current_image(first_image)
        
        # 自動的に動画生成開始
        auto_generate_video(first_image)
```

---

## 📊 動作フロー

### 自動動画生成あり

```
【ユーザー操作】
1. 枚数を3に設定
2. ☑ 1枚目から動画を生成 にチェック
3. 生成開始

【システム処理】
4. 画像を3枚生成 ✅
5. ギャラリーに表示 ✅
6. 自動判定: チェックON → 動画生成開始
7. 1枚目の画像を取得
8. FASHN image-to-video APIで動画生成
9. 動画完了 ✅

【結果】
- 3枚の画像 ✅
- 1枚目の動画 ✅
```

---

## 💡 チェックボックスの制御

### 枚数 = 1

```
枚数: [1]  □ 1枚目から動画を生成（無効・グレーアウト）
```

**理由**: 1枚しか生成しないなら、手動で動画生成すればいいため

### 枚数 = 2-4

```
枚数: [3]  ☑ 1枚目から動画を生成（有効・チェック可能）
```

**用途**: 複数枚生成して、1枚目から自動で動画も作る

---

## 🎬 動画生成の設定

### デフォルト設定

自動動画生成時のデフォルト：
- **長さ**: 10秒
- **解像度**: 1080p
- **プロンプト**: "fashion model rotating 360 degrees and striking elegant poses"

**カスタマイズ**:
動画パネルで設定を変更してから、手動で動画生成することも可能

---

## 🧪 テスト手順

### 1. アプリケーションを再起動

```bash
python app/main.py
```

### 2. 自動動画生成を試す

1. 衣類画像をアップロード
2. 生成設定で:
   - 枚数: **3** に変更
   - ☑ **1枚目から動画を生成** にチェック
3. 生成開始

### 3. 期待される動作

```
進捗:
  画像生成中... (0-80%)
  ↓
  画像生成完了 (100%)
  ↓
  3枚の画像がギャラリーに表示
  ↓
  [Auto Video] 1枚目の画像から自動的に動画を生成します
  ↓
  動画生成中... (0-90%)
  ↓
  動画完了 (100%)
  ↓
  動画パネルに表示
```

### 4. 結果

- ✅ 3枚の画像
- ✅ 1枚目の動画（自動生成）
- ✅ 必要なら2枚目・3枚目も手動で動画化可能

---

## 📋 実装完了

### 追加されたUI要素

```python
self.auto_video_checkbox = QCheckBox("1枚目から動画を生成")
```

### 追加されたロジック

```python
# 枚数変更時の制御
def _on_num_outputs_changed(value):
    self.auto_video_checkbox.setEnabled(value >= 2)

# 生成完了時の自動動画生成
def _on_generation_completed(images, metadata):
    if self.auto_video_checkbox.isChecked():
        # 1枚目から自動動画生成
```

---

## 🎊 完成！

**要望通りの機能が実装されました！**

### 実現されたこと

✅ 動画生成チェックボックス追加  
✅ 枚数2以上でのみ有効  
✅ チェックONで1枚目から自動動画生成  
✅ ユーザーフレンドリーなワークフロー  

---

**アプリケーションを再起動して、試してください！** ✨

枚数を3にして、チェックボックスをONにして生成すると、
画像3枚 + 動画1本が自動的に生成されます！
