# Virtual Try-On（バーチャル試着）機能ガイド

## 🎯 概要

`fashion_model_generation_ai`は、アップロードした服の画像から、その服を着たファッションモデルの画像を自動生成する**Virtual Try-On**アプリケーションです。

## ✨ 主な機能

### 1. 服の画像をアップロード
- Tシャツ、パンツ、ジャケットなど、任意の服の画像を追加
- 複数の服を組み合わせることも可能（コーディネート）

### 2. モデル属性を選択
- 性別（男性/女性）
- 年齢層（20代/30代等）
- 体型（標準/スリム等）
- ポーズ、背景など

### 3. 自動生成
- **固定化された処理フロー**で高品質な画像を生成
- ボタン一つで完了

## 🔧 技術スタック

### 固定化されたAI処理フロー

```
ユーザーが服の画像をアップロード
    ↓
Gemini 2.5 Flash Image
  - 服の画像を直接入力
  - 服の詳細（色、パターン、テキスト）を理解
  - その服を着たモデルを生成
    ↓
完成した画像を表示
```

### 使用AI

- **Gemini 2.5 Flash Image** (google-generativeai)
  - マルチモーダルAI
  - 画像理解 + 画像生成
  - 服のディテールを正確に再現

### なぜGemini 2.5 Flash Imageなのか？

#### ❌ 従来の方法（テキストベース）
```
服の画像 → テキスト化 → 画像生成
"緑のTシャツ"

問題点:
- ロゴやテキストが失われる
- 色が不正確
- パターンが再現されない
```

#### ✅ Gemini 2.5 Flash Image（画像ベース）
```
服の画像 → 直接AIに入力 → 画像生成

メリット:
✓ ロゴ・テキストもそのまま再現
✓ 色が正確
✓ パターン・質感も再現
✓ 細部まで忠実
```

## 📋 使い方

### 1. 初回セットアップ

#### 必要なもの
- Google AI Studio APIキー（無料）
  - https://aistudio.google.com/ で取得

#### APIキーの設定
1. アプリを起動
2. 「設定」→「APIキー設定」を開く
3. プロバイダ: `gemini`
4. APIキー: `YOUR_API_KEY`を入力
5. 保存

### 2. 画像生成の手順

#### ステップ1: 服の画像を追加
```
「+ 画像を追加」ボタンをクリック
↓
服の画像を選択（PNG, JPG, JPEG, WebP）
↓
衣類タイプを選択（TOP, BOTTOM, OUTER等）
```

#### ステップ2: モデル属性を設定
```
- 性別: female/male
- 年齢: 20s/30s/40s
- 体型: standard/slim/athletic
- ポーズ: front/side/walking
- 背景: white/studio
```

#### ステップ3: 生成開始
```
「生成開始」ボタンをクリック
↓
処理中...（数秒〜数十秒）
↓
結果がギャラリーに表示
```

#### ステップ4: 結果を保存
```
「保存」ボタンをクリック
↓
保存先フォルダを選択
↓
PNG形式で保存完了
```

## 🔬 内部処理の詳細

### データの流れ

```
【ユーザー】
    ↓
① 服の画像をアップロード
    ↓
【アプリケーション】
    ↓
② ClothingItemオブジェクト作成
   - image_path: 画像ファイルパス
   - clothing_type: TOP/BOTTOM等
    ↓
③ ModelAttributesオブジェクト作成
   - gender, age_range, body_type等
    ↓
④ GenerationConfig作成（固定）
   - provider: "gemini"
    ↓
⑤ GeminiImagenAdapter.generate() 呼び出し
    ↓
【Gemini 2.5 Flash Image API】
    ↓
⑥ 服の画像（PIL Image形式）+ プロンプトを送信
    ↓
⑦ Gemini AIが処理
   - 画像を詳細に解析
   - その服を着たモデルを生成
    ↓
⑧ 生成画像を返す（PNG形式）
    ↓
【アプリケーション】
    ↓
⑨ ギャラリーに表示
    ↓
【ユーザー】
    ↓
⑩ 確認・保存
```

### コンポーネント

#### 1. UI層 (`app/ui/main_window.py`)
- ユーザーインターフェース
- **AI選択なし**（固定化）
- イベント処理

#### 2. データモデル層 (`app/models/`)
- `ClothingItem`: 服のデータ
- `ModelAttributes`: モデル属性
- `GenerationConfig`: 生成設定

#### 3. アダプター層 (`app/core/adapters/gemini_imagen_adapter.py`)
- Gemini APIとの通信
- 画像の送受信
- エラーハンドリング

#### 4. パイプライン層 (`app/core/pipeline/generate_service.py`)
- 生成処理の統括
- 非同期処理

## 💡 Tips

### 高品質な画像を生成するために

1. **服の画像は高解像度で**
   - 推奨: 600x800ピクセル以上
   - 明るく、鮮明な画像

2. **背景は単色がベスト**
   - 白または無地の背景
   - 服が際立つ

3. **複数の服を組み合わせる場合**
   - 上下のバランスを考慮
   - 最大4アイテムまで

4. **モデル属性を適切に設定**
   - 服のスタイルに合った属性を選択
   - カジュアル/フォーマルを意識

## 🔍 トラブルシューティング

### Q: 画像が生成されない

**A:** 以下を確認してください：
1. APIキーが正しく設定されているか
2. インターネット接続があるか
3. 服の画像ファイルが正常に読み込めるか

### Q: 服の色が違う

**A:** 以下を試してください：
1. 高解像度の画像を使用
2. 明るい環境で撮影された画像を使用
3. 背景が単色の画像を使用

### Q: エラーメッセージが表示される

**A:** エラーの種類によります：
- `APIキーが設定されていません`: APIキーを設定してください
- `クォータ制限`: 無料枠を使い切った可能性があります
- `画像が読み込めません`: ファイルパスや形式を確認してください

### Q: 処理が遅い

**A:** 正常な挙動です：
- 通常10〜30秒程度かかります
- 高解像度画像や複数出力の場合はより時間がかかります
- ネットワーク速度にも依存します

## 📊 性能

### 生成速度
- 1枚: 約10〜30秒
- 4枚: 約40〜120秒

### 画像品質
- 解像度: 1024x1024 / 1024x1792 / 1792x1024
- 形式: PNG
- 品質: 高品質（ディテール保持）

### コスト
- Gemini 2.5 Flash Image: 無料枠内で利用可能
- 有料プランの場合は従量課金

## 🎨 使用例

### 例1: カジュアルコーディネート
```
入力:
- 白いTシャツ
- ブルージーンズ

設定:
- 性別: female
- 年齢: 20s
- 体型: standard

結果:
→ カジュアルな雰囲気の全身写真
```

### 例2: ビジネススタイル
```
入力:
- 黒いブレザー
- 白いシャツ

設定:
- 性別: male
- 年齢: 30s
- 体型: athletic

結果:
→ ビジネスシーンに適したフォーマルな写真
```

## 🔐 セキュリティとプライバシー

### データの取り扱い
- アップロードした画像はGoogle AIのサーバーで処理されます
- 生成された画像はローカルに保存されます
- APIキーは暗号化されてローカルに保存されます

### 推奨事項
- APIキーは他人と共有しないでください
- 機密情報が含まれる画像は使用しないでください

## 📝 ライセンス

本アプリケーションはApache 2.0ライセンスの下で提供されています。

---

**作成日**: 2025年11月11日  
**バージョン**: 2.0.0  
**使用AI**: Gemini 2.5 Flash Image

